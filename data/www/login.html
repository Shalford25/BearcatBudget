<! -- This is the login page -- >
<!DOCTYPE html>
<html>
    <head>
    <title>Login | Bearcat Budget</title>
    <link rel="stylesheet" href="../stylesheets/login.css" type="text/css"/>
        <style>
            html{
                background: url('../assets/cen10.jpg') no-repeat center center fixed;
                background-size: cover;
                background-attachment: fixed;
            }
        </style>
        <title>Login | Bearcat Budget</title>

        <script src="../javascript/mySQLintegration.js"></script>
        <script>
            async function login() {
                const username = document.getElementById('userName').value;
                const password = document.getElementById('pwd').value;

                if (!username || !password) {
                    alert('Please enter both username and password.');
                    return;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 5-second timeout

                try {
                    const response = await fetch('http://localhost:3500/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password }),
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        const errorDetails = await response.text();
                        throw new Error(`HTTP error! Status: ${response.status}, Details: ${errorDetails}`);
                    }

                    const result = await response.json();
                    if (result.success) {
                        alert(result.message);
                    } else {
                        alert(result.message);
                    }
                } catch (error) {
                    if (error.name === 'AbortError') {
                        alert('Request timed out. Please try again.');
                    } else {
                        console.error('Fetch error details:', {
                            message: error.message,
                            stack: error.stack,
                        });
                        alert('Failed to connect to the server. Please try again later.');
                    }
                }
            }
        </script>

        
    </head>
    <body>
        <div class="top-bar"><h1> Bearcat Budget </h1></div>
            <div class="accent-bar accent-bar-top">
        </div>
        
          

        <div class="loginframe" >
            <h2>For Existing Users</h2>
        <br> <label for ="userName"> Username: </label>
        <br>
        <input type ="text" id="userName" name="userName" value="">
        <br>
        <br>
        <label for ="Password"> Password:
        </label>
        <br>
        <input type="password" id="pwd" name="pwd" value="">
        <br><br>
        <input type="checkbox" id="keepLoggedIn" name="keepLoggedIn" value="1"> Keep me Logged In
        <br><br>
        <button type="button" onclick="login()">Login</button>
        </div>
        <div class="accent-bar accent-bar-bottom"></div>
        <div class="bottom-bar"></div>
    </body>
</html>